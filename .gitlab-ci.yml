stages:
  - rtl_chk
  - bhv_sim
  - bit_gen
  - fpga_eval

variables:
    GIT_SUBMODULE_STRATEGY: recursive

default:
  image: gitlab.agileserve.org.cn:15050/zelin/vivado-ci-tools/vivado-vnc-ci-multistage:v2.5
  tags: 
    - k8s
  before_script:
    - cd flow 

rtl_chk:
  stage: rtl_chk
  script:
    - make HW_ACT=rtl_chk CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/run_log

bhv_sim_memcpy:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=basic:01 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_sum:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:01 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_mov-c:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:02 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_fib:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:03 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_add:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:04 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_if-else:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:05 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_pascal:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:06 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_quick-sort:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:07 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_select-sort:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:08 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_max:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:09 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_min3:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:10 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_switch:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:11 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_bubble-sort:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=medium:12 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_shuixianhua:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:01 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_sub-longlong:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:02 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_bit:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:03 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_recursion:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:04 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_fact:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:05 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_add-longlong:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:06 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_shift:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:07 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_wanshu:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:08 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_goldbach:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:09 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_leap-year:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:10 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_prime:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:11 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_mul-longlong:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:12 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_load-store:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:13 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_to-lower-case:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:14 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_movsx:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:15 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_matrix-mul:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:16 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bhv_sim_unalign:
  stage: bhv_sim
  script:
    - make HW_ACT=bhv_sim HW_VAL=advanced:17 CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/sim
      - flow/hardware/vivado_out/run_log

bit_gen:
  stage: bit_gen
  script:
    - make HW_ACT=bit_gen CI_RUN=y vivado_prj
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/hardware/vivado_out/synth_rpt
      - flow/hardware/vivado_out/impl_rpt
      - flow/hw_plat/
      - flow/hardware/vivado_out/run_log

fpga_eval:
  stage: fpga_eval
  tags:
    - nf
  script:
    - mkdir -p ./run/log 
    - cd run/
    - bash ci_run.sh | tee ./log/cloud_run.log
  artifacts:
    name: "$CI_JOB_STAGE-$CI_COMMIT_REF_NAME-$CI_COMMIT_SHORT_SHA"
    when: always
    paths:
      - flow/run/log/

